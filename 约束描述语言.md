约束描述语言语法通过递归定义：

$$ f := \forall~v~\in~P~(f)~\vert~\exists~v~\in~P~(f)~\vert\\
\forall~v~\in~P~\text{with}~ffunc(v, v_i,...,v_j)~(f)~\vert\\
\exists~v~\in~P~\text{with}~ffunc(v, v_i,...,v_j)~(f)~\vert\\
(f)~\text{and}~(f)~\vert~(f)~\text{or}~(f)~\vert~(f)~\text{implies}~(f)~\vert~\text{not}(f)~\vert\\
bfunc(v_1,...,v_n)~\vert~\textsf{True}~\vert~\textsf{False} $$

上述语法表述中一共包含了11种公式（两两之间用$\vert$相隔开），我们可以将这11种公式分为3类：量词公式（前四种公式），连接词公式（and，or, implies, not四种公式）和终端公式（bfunc，True，False三种公式）。

+ 量词公式：$v$ 是一个变量，$P$ 是一个pattern名，$v$从$P$匹配到的实例中选取实例作为赋值。以$\forall$公式为例，它的语义为$P$中所有的实例都要满足子公式$f$。$ffunc(v,v_i,...,v_j)$是一个filter函数，它作为一个增强条件，表示$P$中只有满足该filter函数($ffunc$返回True）的实例才会被$v$作为赋值在子公式$f$中被检测。
+ 连接词公式：通过$\text{and}, \text{or}, \text{implies},$和$\text{not}$保留字连接两个公式来分别表示两个公式的与，或，蕴含，非等逻辑关系。
+ 终端公式：$bfunc(v_1,...,v_n)$是最终的检测函数，它以若干变量的赋值作为输入，输出True或者False。

用于存储和作为程序输入时，约束使用 XML 格式序列化。最外层为`<formula>`标签，内部为具体的约束表达式。约束描述语言和 XML 格式的对应关系如下：

- $\forall~v~\in~P~(f)$:
    ```xml
    <forall var="v" in="P">
        <f/>
    </forall>
    ```

    其中 `<f/>` 应该为子公式 `f` 的 XML 形式。

- $\exists~v~\in~P~(f)$:
    ```xml
    <exists var="v" in="P">
        <f/>
    </exists>
    ```

    其中 `<f/>` 应该为子公式 `f` 的 XML 形式。

- $\forall~v~\in~P~\text{with}~ffunc(v, v_i,...,v_j)~(f)$:
    ```xml
    <forall var="v" in="P">
        <filter name="ffunc">
            <param pos="1" name="v"/>
            <param pos="2" name="v_i"/>
            <param pos="j" name="v_j"/>
        </filter>
        <f/>
    </forall>
    ```

    其中 `<param/>` 的数量需要和 `ffunc` 的参数数量保持一致。 `<f/>` 应该为子公式 `f` 的 XML 形式。

- $\exists~v~\in~P~\text{with}~ffunc(v, v_i,...,v_j)~(f)$:
    ```xml
    <exists var="v" in="P">
        <filter name="ffunc">
            <param pos="1" name="v"/>
            <param pos="2" name="v_i"/>
            <param pos="j" name="v_j"/>
        </filter>
        <f/>
    </exists>
    ```

    其中 `<f/>` 应该为子公式 `f` 的 XML 形式。

- $(f_1)~\text{and}~(f_2)$:
    ```xml
    <and>
        <f1/>
        <f2/>
    </and>
    ```

    `<and>` 标签内必须包含且仅包含两个子标签，其中 `<f1/>` 和 `<f2/>` 应该分别为子公式 `f_1` 和 `f_2` 的 XML 形式。

- $(f_1)~\text{or}~(f_2)$:
    ```xml
    <or>
        <f1/>
        <f2/>
    </or>
    ```

    `<or>` 标签内必须包含且仅包含两个子标签，其中 `<f1/>` 和 `<f2/>` 应该分别为子公式 `f_1` 和 `f_2` 的 XML 形式。

- $(f_1)~\text{implies}~(f_2)$:
    ```xml
    <implies>
        <f1/>
        <f2/>
    </implies>
    ```

    `<implies>` 标签内必须包含且仅包含两个子标签，其中 `<f1/>` 和 `<f2/>` 应该分别为子公式 `f_1` 和 `f_2` 的 XML 形式。

- $\text{not}(f)$:
    ```xml
    <not>
        <f/>
    </not>
    ```

    `<implies>` 标签内必须包含且仅包含一个子标签，其中 `<f/>` 应该为子公式 `f` 的 XML 形式。

- $bfunc\_1(v_1,...,v_n)$:
    ```xml
    <bfunc name="bfunc_1">
        <param pos="1" name="v_1"/>
        <param pos="2" name="v_2"/>
        <param pos="n" name="v_n"/>
    </bfunc>
    ```

    其中 `<param/>` 的数量需要和 `bfunc` 的参数数量保持一致。

下面是一个约束写成 XML 的例子：

```xml
<formula>
    <forall var="v1" in="functionDocException">
        <forall var="v2" in="functionDefWithFunctionCall">
            <filter name="signature_is_same">
                <param pos="1" var="v2"/>
                <param pos="2" var="v1"/>
            </filter>
            <or>
                <bfunc name="code_throws_exception">
                    <param pos="1" var="v2"/>
                    <param pos="2" var="v1"/>
                </bfunc>
                <exists var="v3" in="functionCallWithSubtreeId">
                    <filter name="is_in_subtree">
                        <param pos="descendant" var="v3"/>
                        <param pos="ancestor" var="v2"/>
                    </filter>
                    <exists var="v4" in="functionDocException">
                        <filter name="function_call_matches_doc_exception">
                            <param pos="1" var="v3"/>
                            <param pos="2" var="v4"/>
                        </filter>
                        <exists var="vEx2" in="functionDocException">
                            <bfunc name="exception_is_same">
                                <param pos="1" var="v1"/>
                                <param pos="2" var="v4"/>
                            </bfunc>
                        </exists>
                    </exists>
                </exists>
            </or>
        </forall>
    </forall>
</formula>
```